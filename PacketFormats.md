
Generic any unreliable packet:

```
+---------------+===========+
| Payload [any] | Type [1B] |
+---------------+===========+
```

Reliable packet:

How to store message size, packet id, packet offset
```
+==================+=============+================+---------------+=============+===========+
| TotalLength [2B] | FragId [1B] | FragCount [1B] | Payload [any] | SeqNum [4B] | Type [1B] |
+==================+=============+================+---------------+=============+===========+
```

Encrypted unreliable packet:
```
+==========+==============+---------------+===========+
| IV [12B] | TagMAC [16B] | Payload [any] | Type [1B] |
+==========+==============+---------------+===========+
```

Encrypted reliable packet:
```
+==================+=============+================+==========+==============+---------------+=============+===========+
| TotalLength [2B] | FragId [1B] | FragCount [1B] | IV [12B] | TagMAC [16B] | Payload [any] | SeqNum [4B] | Type [1B] |
+==================+=============+================+==========+==============+---------------+=============+===========+
```

Ping/Pong:
```
+===============+=============+===========+
| DateTime [8B] | SeqNum [4B] | Type [1B] |
+===============+=============+===========+
```

MTU:
```
+---------------+===================+===========+
| Payload [any] | CustomSeqNum [4B] | Type [1B] |
+---------------+===================+===========+
```






# Generic packets types

```
+------------+----------+-----------------------------------+
| Offset [B] | Size [B] | Description                       |
+------------+----------+-----------------------------------+
|                                                           |
|         Any single packet unreliable HEADER   [1B]        |
+------------+----------+-----------------------------------+
| 0          | N        | Payload (+encryption)             |
+------------+----------+-------------------+---------------+
| N          | 1        | Type               }   Header     |
+------------+----------+-------------------+---------------+
|                                                           |
|         Any single packet reliable HEADER   [5B]          |
+------------+----------+-----------------------------------+
| 0          | N        | Payload (+encryption)             |
+------------+----------+-------------------+---------------+
| N          | 4        | SeqNum*           |               |
+------------+----------+------------------- }   Header     |
| N+4        | 1        | Type              |               |
+------------+----------+-------------------+---------------+
|                                                           |
|     Any-Multipacket message HAED packet HEADER   [11B]    |
+------------+----------+-----------------------------------+
| 0          | N        | Payload (+encryption)             |
+------------+----------+-------------------+---------------+
| N          | 4        | Message size      |               |
+------------+----------+-------------------|               |
| N+4        | 2        | Packets count     |               |
+------------+----------+------------------- }   Header     |
| N+6        | 4        | SeqNum*           |               |
+------------+----------+-------------------|               |
| N+10       | 1        | Type > Header     |               |
+------------+----------+-------------------+---------------+
|                                                           |
|     Any-Multipacket message NEXT packet HEADER   [9B]     |
+------------+----------+-----------------------------------+
| 0          | N        | Payload (+encryption)             |
+------------+----------+-------------------+---------------+
| N          | 2        | Packets count     |               |
+------------+----------+-------------------|               |
| N          | 2        | Packet id         |               |
+------------+----------+------------------- }   Header     |
| N+4        | 4        | SeqNum*           |               |
+------------+----------+-------------------|               |
| N+6        | 1        | Type > Header     |               |
+------------+----------+-------------------+---------------+
|                                                           |
|     Any-Multipacket message TAIL packet   [9B]            |
+------------+----------+-----------------------------------+
| 0          | N        | Payload (+encryption)             |
+------------+----------+-------------------+---------------+
| N          | 2        | Packets count     |               |
+------------+----------+-------------------|               |
| N          | 4        | Offset            |               |
+------------+----------+------------------- }   Header     |
| N+4        | 4        | SeqNum*           |               |
+------------+----------+-------------------|               |
| N+6        | 1        | Type > Header     |               |
+------------+----------+-------------------+---------------+
|                                                           |
|         Encrypted any packet HEADER   [28B+X]             |
+------------+----------+-----------------------------------+
| 0          | 16       | AEAD Tag                          |
+------------+----------+-----------------------------------+
| 16         | N        | Payload                           |
+------------+----------+-----------------------------------+
| N+16       | 12       | AEAD IV                           |
+------------+----------+-----------------------------------+
| N+28       | X        | Any Header > used for validation  |
+------------+----------+-----------------------------------+

+------------+----------+-------------------+---------------+
|                                                           |
|                  ACK packet PAYLOAD                       |
+------------+----------+--------------------+--------------+
| 0          | 1        | N = Count SeqNum   |              |
|------------+----------+--------------------|              |
|    | 1     | 4*N      | SeqNum             |              |
|    |-------+----------+-------------------- }   Payload   |
| N {  5     | 1*N      | M = Count packets  |              |
|    |-------+----------+--------------------|              |
|    | M { 6 | 2*M(N)   | Offset             |              |
+------------+----------+--------------------+--------------+
```

* SeqNum - each individual packets has unique value
(in a given current SeqNum window).
























